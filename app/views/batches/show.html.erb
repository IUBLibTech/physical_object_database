<% content_for :context_menu do %>
	<div class="contextMenuItem">
	  <%= link_to("Edit Batch", {:action => 'edit', :id => @batch.id}) if policy(@batch).edit? %>
	</div>
	<div class="contextMenuItem">
	  <%= link_to("Delete Batch", batch_path(@batch.id), method: :delete, data: {confirm: 'Are you sure you want to delete this Batch?'}) if policy(@batch).destroy? %>
	</div>
	<div class="contextMenuItem">
	  <%= link_to "View Workflow History", workflow_history_batch_path(@batch) if policy(@batch).workflow_history? %>
	</div>

<% end %>
<div class='left'>
	<div id="batch_div">
	  <h2>Batch</h2>
	    Shipping Manifest: <%= link_to 'Excel File', batch_path(id: 'batch_' + @batch.id.to_s, format: :xls) if policy(@batch).show? %><br/>
	    Bins List: <%= link_to 'Excel File', list_bins_batch_path(@batch), format: :xls if policy(@batch).list_bins? %>
	    <% @edit_mode = false %>
	    <%= render(:partial => "batch") %>
	</div>
	<div id="bins_div">
	   <h2>Bins in this Batch: <%= @batch.bins.size %></h2>
	   <%= render 'bins/bins_table' %>
	</div>
</div>
<div class='left'>
	<h2>Available Bins: <%= @available_bins.size %></h2>
	<% if @batch.packed_status? %>
	  <b class='warning'><%= Batch.packed_status_message %></b>
	<% else %>
	<%= form_for(@batch, url: {action: 'add_bin'}) do |f| %>
		<table>
			<thead>
				<tr class="header">
			    <th>MDPI barcode</th>
			    <th>Identifier</th>
			    <th>Item Count</th>
			    <th>Physical Location</th>
			    <th>Description</th>
			    <th>Add</th>
			  </tr>
			 </thead>
			 <tbody>
			 	<% @available_bins.each do |b| %>
					<tr>
						<td>
							<%= b.mdpi_barcode %>
						</td>
						<td>
							<%= b.identifier %>
						</td>
						<td>
							<% if b.physical_objects.any? %>
							  <%= b.physical_objects.size %>
							<% elsif b.boxes.any? %>
							  <%= b.boxed_physical_objects.size %>
							<% end %>
						</td>
						<td>
							<%= b.physical_location %>
						</td>
						<td>
							<%= b.description %>
						</td>
						<td>
							<%= check_box_tag 'bin_ids[]', b.id, false, disabled: @batch.packed_status? %>
						</td>
					</tr>
			 	<% end %>
			 </tbody>
		</table>
		<%= f.submit("Add selected bins to #{@batch.identifier}", { disabled: @batch.packed_status? }) %>
	<% end %>
	<% end %>
</div>
